<!DOCTYPE html>
<html lang="pt-br">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE-edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Arduino Node.js</title>
	
	<!-- Socket.io - aqui chamamos nosso socket. -->
	<script src="/socket.io/socket.io.js"></script>
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css" integrity="sha384-B0vP5xmATw1+K9KRQjQERJvTumQW0nPEzvF6L/Z6nronJ3oUOFUFpCjEUQouq2+l" crossorigin="anonymous">
	<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-Piv4xVNRyMGpqkS2by6br4gNJ7DXjqk09RmUpJ8jgGtD7zP9yug3goQfGII0yAns" crossorigin="anonymous"></script>

	<link rel="stylesheet" type="text/css" href="../css/index.css" media="screen" />
	<!-- Chart - aqui chamamos nossa lib que gera o gráfico. -->
	<script src="js/Chart.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/chart.js@2.8.0"></script>
</head>
 
<body>
	<!-- criamos um canvas e atribuímos um tamanho que será o gráfico. -->
	<div class="principal">
		<div class="row">
			<div class="w-100"></div>
			<div class="col graph">
				<canvas id="myChart" width="300" height="200"></canvas>
			</div>
			<div class="col graph">
				<canvas id="myChartY" width="300" height="200"></canvas>
			</div>
			<div class="w-100"></div>
			<div class="col graph">
				<canvas id="myChartZ" width="300" height="200"></canvas>
			</div>
			<div class="col graph">Column</div>
		</div>
	</div>
	
	<script type="text/javascript">
		var ctx = document.getElementById("myChart").getContext("2d");
		var myChart = new Chart(ctx, {
			type: 'line',
			data: {
				labels: [],
				datasets: [
					{
						label: ["Eixo X"],
						backgroundColor: "rgba(255, 99, 132)",
						borderColor: "rgba(255, 99, 132)",
						data: [],
						fill: false,
					},
				]
			},
			options: {
				responsive: true,
				maintainAspectRatio: false,
				scales: {
					yAxes: [{
						scaleLabel: {
							display: true,
							labelString: 'Aceleração (m/s²)'
						}
					}],
					xAxes: [{
						scaleLabel: {
							display: true,
							labelString: 'Frequência (Hz)',
							type: 'time',
						},
					}]
				}     
			}
		});

		var ctxY = document.getElementById("myChartY").getContext("2d");
		var myChartY = new Chart(ctxY, {
			type: 'line',
			data: {
				labels: [],
				datasets: [
					{
						label: ["Eixo Y"],
						backgroundColor: "rgba(51, 204, 255)",
						borderColor: "rgba(51, 204, 255)",
						data: [],
						fill: false,
					},
				]
			},
			options: {
				responsive: true,
				maintainAspectRatio: false,
				scales: {
					yAxes: [{
						scaleLabel: {
							display: true,
							labelString: 'Aceleração (m/s²)'
						}
					}],
					xAxes: [{
						scaleLabel: {
							display: true,
							labelString: 'Frequência (Hz)',
							type: 'time',
						},
					}]
				}     
			}
		});

		var ctxZ = document.getElementById("myChartZ").getContext("2d");
		var myChartZ = new Chart(ctxZ, {
			type: 'line',
			data: {
				labels: [],
				datasets: [
					{
						label: ["Eixo Z"],
						backgroundColor: "rgba(60,179,113)",
						borderColor: "rgba(60,179,113)",
						data: [],
						fill: false,
					},
				]
			},
			options: {
				responsive: true,
				maintainAspectRatio: false,
				scales: {
					yAxes: [{
						scaleLabel: {
							display: true,
							labelString: 'Aceleração (m/s²)'
						}
					}],
					xAxes: [{
						scaleLabel: {
							display: true,
							labelString: 'Frequência (Hz)',
							type: 'time',
						},
					}]
				}     
			}
		});
		
		let arrayY = [];
		let arrayX = [];
		let arrayZ = [];
		let arrayLabelX = [];
		let arrayLabelY = [];
		let arrayLabelZ = [];

		function addData(array, arrayLabel, label, data) {
			arrayLabel.push(label);
			array.push(data);
		}

		function plotar() {
			arrayX.shift();
			arrayLabelX.shift();
			myChart.data.labels = arrayLabelX;
			myChart.data.datasets[0].data = arrayX;
			myChart.update();
			arrayX = [];
			arrayLabelX = [];

			arrayY.shift();
			arrayLabelY.shift();
			myChartY.data.labels = arrayLabelY;
			myChartY.data.datasets[0].data = arrayY;
			myChartY.update();
			arrayY = [];
			arrayLabelY = [];

			arrayZ.shift();
			arrayLabelZ.shift();
			myChartZ.data.labels = arrayLabelZ;
			myChartZ.data.datasets[0].data = arrayZ;
			myChartZ.update();
			arrayZ = [];
			arrayLabelZ = [];
		}

		var frequencia = 0;
		let cont = 0;


		var socket = io();
		socket.on("dadosArduino", function(dado) {	
			const eixo = dado.substring(0,1);
			const func = dado.substring(1,2);
			const newDado = dado.substring(2);
			if(eixo === 'f') {
				frequencia = newDado;
			}
			if(func == 'p') {
				console.log('peek: ' + newDado);
			}
			if(eixo == 'x') {
				addData(arrayX, arrayLabelX, frequencia, newDado);
			}	
			if(eixo == 'y') {
				addData(arrayY, arrayLabelY, frequencia, newDado);
			}
			if(eixo == 'z') {
				addData(arrayZ, arrayLabelZ, frequencia, newDado);
			}
			if(eixo == '-') {
				plotar();
			}
		});
	</script>
 
</body>
</html>